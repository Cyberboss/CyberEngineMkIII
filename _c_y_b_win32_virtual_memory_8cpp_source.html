<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CyberEngineMkIII: Engine/Platform/System/Win32/CYBWin32VirtualMemory.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CyberEngineMkIII
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="contexts.html"><span>Contexts</span></a></li>
      <li><a href="conventions.html"><span>Conventions</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="todo.html"><span>Todo</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b6ee6e7e9547e675db4add2e5de97da.html">Engine</a></li><li class="navelem"><a class="el" href="dir_122a29e5a4716e8495cfd46565c6ab00.html">Platform</a></li><li class="navelem"><a class="el" href="dir_e9eae8a6c23bf15f95f87e280df89ef4.html">System</a></li><li class="navelem"><a class="el" href="dir_7469f1ccc5732b03dacfb15846545cb9.html">Win32</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CYBWin32VirtualMemory.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_c_y_b_8hpp.html">CYB.hpp</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac7ed65763e3bc22cb24270f1506c402b">    3</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac7ed65763e3bc22cb24270f1506c402b">CYB::Platform::System::Implementation::VirtualMemory::SystemPageSize</a>(<span class="keywordtype">void</span>) noexcept {</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    Win32::SYSTEM_INFO Info;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().<a class="code" href="class_c_y_b_1_1_engine_1_1_core.html#af39e0d636e6be2e09a6ec5123dc91d79">FModuleManager</a>.<a class="code" href="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager.html#a59461a5f0ac379fd364a56feb70c0df4">FK32</a>.Call&lt;Modules::Kernel32::GetSystemInfo&gt;(&amp;Info);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="keywordflow">return</span> Info.dwPageSize;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac3605096b80af9ccf19068f09539032d">    9</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac3605096b80af9ccf19068f09539032d">CYB::Platform::System::Implementation::VirtualMemory::PageAlignedUpperBound</a>(<span class="keywordtype">void</span>* AMemory, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> APageSize) noexcept {</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(AMemory) + (APageSize - (reinterpret_cast&lt;unsigned long long&gt;(AMemory) % APageSize)));</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab39cefb14bd5aaceea8884746cd14011">   13</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab39cefb14bd5aaceea8884746cd14011">CYB::Platform::System::VirtualMemory::InitReservation</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ANumBytes) {</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keywordflow">if</span> (ANumBytes &gt;= 1024) {</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        <span class="keywordtype">void</span>* <span class="keyword">const</span> Result(<a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().FModuleManager.FK32.Call&lt;Modules::Kernel32::VirtualAlloc&gt;(<span class="keyword">nullptr</span>, ANumBytes, Win32::DWORD(MEM_RESERVE), Win32::DWORD(PAGE_NOACCESS)));</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        <span class="keywordflow">if</span> (Result != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    }</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6a1e06b12af5defbb743723e6d105a8344">Exception::Internal::MEMORY_RESERVATION_FAILURE</a>);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab37e16fe8820121af7e0dc0f88ca303b">   22</a></span>&#160;<a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab37e16fe8820121af7e0dc0f88ca303b">CYB::Platform::System::VirtualMemory::~VirtualMemory</a>() {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    API::Assert::NotEqual&lt;Win32::BOOL&gt;(<a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().<a class="code" href="class_c_y_b_1_1_engine_1_1_core.html#af39e0d636e6be2e09a6ec5123dc91d79">FModuleManager</a>.<a class="code" href="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager.html#a59461a5f0ac379fd364a56feb70c0df4">FK32</a>.Call&lt;Modules::Kernel32::VirtualFree&gt;(FReservation, 0U, Win32::DWORD(MEM_RELEASE)), FALSE);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;}</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#afd70a4b05a2147d38396e22264053cc1">   26</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#afd70a4b05a2147d38396e22264053cc1">CYB::Platform::System::VirtualMemory::Commit</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ANumBytes) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">if</span> (ANumBytes &gt; FCommitSize) {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">if</span> (ANumBytes &lt;= FReservationSize) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            <span class="keywordtype">bool</span> ThrowOccurred(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                Access(AccessLevel::READ_WRITE);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            <span class="keywordflow">catch</span> (<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a> AException) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                API::Assert::Equal&lt;unsigned int&gt;(AException.<a class="code" href="class_c_y_b_1_1_exception_1_1_base.html#a27ff0a025169b55d9daf32105cdc8c1f">FErrorCode</a>, <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6abd50f754dc98ef83fc1d070e3052a954">Exception::Internal::MEMORY_PROTECT_FAILURE</a>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                ThrowOccurred = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            <span class="keywordflow">if</span> (ThrowOccurred)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6adc9dc49a6a7bc953e3e1c1e9b095d7bf">Exception::Internal::MEMORY_COMMITAL_FAILURE</a>);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">void</span>* <span class="keyword">const</span> Result(<a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().FModuleManager.FK32.Call&lt;Modules::Kernel32::VirtualAlloc&gt;(FReservation, ANumBytes, Win32::DWORD(MEM_COMMIT), Win32::DWORD(PAGE_READWRITE)));</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">if</span> (Result == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6adc9dc49a6a7bc953e3e1c1e9b095d7bf">Exception::Internal::MEMORY_COMMITAL_FAILURE</a>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            FCommitSize = ANumBytes;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6adc9dc49a6a7bc953e3e1c1e9b095d7bf">Exception::Internal::MEMORY_COMMITAL_FAILURE</a>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab66b2c60b2172d5bf19faeae61f61dbf">   49</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab66b2c60b2172d5bf19faeae61f61dbf">CYB::Platform::System::VirtualMemory::Access</a>(<span class="keyword">const</span> <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#aad25779b8de468752210a7dba03ec033">AccessLevel</a> AAccessLevel) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    Win32::MEMORY_BASIC_INFORMATION Info;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().FModuleManager.FK32.Call&lt;Modules::Kernel32::VirtualQuery&gt;(FReservation, &amp;Info, <span class="keyword">sizeof</span>(Win32::MEMORY_BASIC_INFORMATION)) == 0)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6abd50f754dc98ef83fc1d070e3052a954">Exception::Internal::MEMORY_PROTECT_FAILURE</a>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (Info.State == MEM_COMMIT) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        Win32::DWORD Last;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">//for some reason we can&#39;t use the base of the allocation when protecting :/</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().FModuleManager.FK32.Call&lt;Modules::Kernel32::VirtualProtect&gt;(FReservation, Info.RegionSize, static_cast&lt;Win32::DWORD&gt;(</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            AAccessLevel == AccessLevel::READ_WRITE ? </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            PAGE_READWRITE : </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            (AAccessLevel == AccessLevel::NONE ?</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                PAGE_NOACCESS : PAGE_READONLY)),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            &amp;Last) == FALSE)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html">Exception::Internal</a>(<a class="code" href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6abd50f754dc98ef83fc1d070e3052a954">Exception::Internal::MEMORY_PROTECT_FAILURE</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#a61ad2a32f9eb2c4e710ebf87cc595521">   67</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#a61ad2a32f9eb2c4e710ebf87cc595521">CYB::Platform::System::VirtualMemory::Discard</a>(<span class="keywordtype">void</span>* <span class="keyword">const</span> AMemory, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ANumBytes) noexcept {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="class_c_y_b_1_1_a_p_i_1_1_assert.html#a48f599989cfa6afa4419c2ebf8283090">API::Assert::LessThanOrEqual</a>(static_cast&lt;byte*&gt;(FReservation), static_cast&lt;byte*&gt;(AMemory));</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="class_c_y_b_1_1_a_p_i_1_1_assert.html#a48f599989cfa6afa4419c2ebf8283090">API::Assert::LessThanOrEqual</a>(static_cast&lt;byte*&gt;(AMemory), static_cast&lt;byte*&gt;(FReservation) + FCommitSize);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="class_c_y_b_1_1_a_p_i_1_1_assert.html#a48f599989cfa6afa4419c2ebf8283090">API::Assert::LessThanOrEqual</a>(static_cast&lt;byte*&gt;(AMemory) + ANumBytes, static_cast&lt;byte*&gt;(FReservation) + FCommitSize);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> PageSize(<a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac7ed65763e3bc22cb24270f1506c402b">Implementation::VirtualMemory::SystemPageSize</a>());</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (ANumBytes &gt;= PageSize) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">auto</span> <span class="keyword">const</span> AlignedMemory(<a class="code" href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac3605096b80af9ccf19068f09539032d">Implementation::VirtualMemory::PageAlignedUpperBound</a>(AMemory, PageSize));</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> Difference(reinterpret_cast&lt;unsigned long long&gt;(AlignedMemory) - reinterpret_cast&lt;unsigned long long&gt;(AMemory));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">if</span> (Difference &lt; ANumBytes) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> BytesAvailableToDiscard(ANumBytes - Difference);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> TrueDiscardSize(BytesAvailableToDiscard - (BytesAvailableToDiscard % PageSize));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">if</span>(TrueDiscardSize &gt;= PageSize</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                &amp;&amp; <a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().FModuleManager.FK32Extended.Loaded&lt;Modules::Kernel32Extended::DiscardVirtualMemory&gt;())</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    <a class="code" href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">Core</a>().<a class="code" href="class_c_y_b_1_1_engine_1_1_core.html#af39e0d636e6be2e09a6ec5123dc91d79">FModuleManager</a>.<a class="code" href="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager.html#a66ea8dd4585d74c437c456cb37454037">FK32Extended</a>.Call&lt;Modules::Kernel32Extended::DiscardVirtualMemory&gt;(AlignedMemory, TrueDiscardSize);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory_html_ac3605096b80af9ccf19068f09539032d"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac3605096b80af9ccf19068f09539032d">CYB::Platform::System::Implementation::VirtualMemory::PageAlignedUpperBound</a></div><div class="ttdeci">static void * PageAlignedUpperBound(void *const AMemory, const unsigned int APageSize) noexcept</div><div class="ttdoc">Get the base address of a page given an address. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00009">CYBWin32VirtualMemory.cpp:9</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager_html_a59461a5f0ac379fd364a56feb70c0df4"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager.html#a59461a5f0ac379fd364a56feb70c0df4">CYB::Platform::Modules::ModuleManager::FK32</a></div><div class="ttdeci">AMKernel32 FK32</div><div class="ttdoc">Kernel32.dll Win7+. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_module_manager_8hpp_source.html#l00010">CYBModuleManager.hpp:10</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager_html_a66ea8dd4585d74c437c456cb37454037"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_modules_1_1_module_manager.html#a66ea8dd4585d74c437c456cb37454037">CYB::Platform::Modules::ModuleManager::FK32Extended</a></div><div class="ttdeci">AMKernel32Extended FK32Extended</div><div class="ttdoc">Kernel32.dll Win8.1+, Optional. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_module_manager_8hpp_source.html#l00011">CYBModuleManager.hpp:11</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_afd70a4b05a2147d38396e22264053cc1"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#afd70a4b05a2147d38396e22264053cc1">CYB::Platform::System::VirtualMemory::Commit</a></div><div class="ttdeci">void Commit(const unsigned long long ANumBytes)</div><div class="ttdoc">Commit some amount of memory from a reserved address space. On return, the memory will be usable...</div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00026">CYBWin32VirtualMemory.cpp:26</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_exception_1_1_internal_html_a710ed917a589d4325fec85c3be07e8c6abd50f754dc98ef83fc1d070e3052a954"><div class="ttname"><a href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6abd50f754dc98ef83fc1d070e3052a954">CYB::Exception::Internal::MEMORY_PROTECT_FAILURE</a></div><div class="ttdoc">Memory protection could not be set. </div><div class="ttdef"><b>Definition:</b> <a href="_exception_8hpp_source.html#l00107">Exception.hpp:107</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_a61ad2a32f9eb2c4e710ebf87cc595521"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#a61ad2a32f9eb2c4e710ebf87cc595521">CYB::Platform::System::VirtualMemory::Discard</a></div><div class="ttdeci">void Discard(void *const AMemory, const unsigned long long ANumBytes) noexcept</div><div class="ttdoc">Designate an area of memory as not needed for the time being, improving performance. It may be reaccessed at any time, however, it should be assumed to be filled with random data upon doing so. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00067">CYBWin32VirtualMemory.cpp:67</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_engine_1_1_core_html_af39e0d636e6be2e09a6ec5123dc91d79"><div class="ttname"><a href="class_c_y_b_1_1_engine_1_1_core.html#af39e0d636e6be2e09a6ec5123dc91d79">CYB::Engine::Core::FModuleManager</a></div><div class="ttdeci">Platform::Modules::ModuleManager FModuleManager</div><div class="ttdoc">Loads and contains required modules. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_core_8hpp_source.html#l00015">CYBCore.hpp:15</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_ab37e16fe8820121af7e0dc0f88ca303b"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab37e16fe8820121af7e0dc0f88ca303b">CYB::Platform::System::VirtualMemory::~VirtualMemory</a></div><div class="ttdeci">~VirtualMemory()</div><div class="ttdoc">Release a reservation. All memory that was used in entire reserved address space will be lost...</div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00022">CYBWin32VirtualMemory.cpp:22</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_exception_1_1_base_html_a27ff0a025169b55d9daf32105cdc8c1f"><div class="ttname"><a href="class_c_y_b_1_1_exception_1_1_base.html#a27ff0a025169b55d9daf32105cdc8c1f">CYB::Exception::Base::FErrorCode</a></div><div class="ttdeci">const unsigned int FErrorCode</div><div class="ttdoc">The assigned error code. </div><div class="ttdef"><b>Definition:</b> <a href="_exception_8hpp_source.html#l00018">Exception.hpp:18</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_exception_1_1_internal_html_a710ed917a589d4325fec85c3be07e8c6a1e06b12af5defbb743723e6d105a8344"><div class="ttname"><a href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6a1e06b12af5defbb743723e6d105a8344">CYB::Exception::Internal::MEMORY_RESERVATION_FAILURE</a></div><div class="ttdoc">Memory could not be reserved. </div><div class="ttdef"><b>Definition:</b> <a href="_exception_8hpp_source.html#l00108">Exception.hpp:108</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_ab39cefb14bd5aaceea8884746cd14011"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab39cefb14bd5aaceea8884746cd14011">CYB::Platform::System::VirtualMemory::InitReservation</a></div><div class="ttdeci">static void * InitReservation(const unsigned long long ANumBytes)</div><div class="ttdoc">Reserve some amount of address space for future allocation. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00013">CYBWin32VirtualMemory.cpp:13</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_exception_1_1_internal_html_a710ed917a589d4325fec85c3be07e8c6adc9dc49a6a7bc953e3e1c1e9b095d7bf"><div class="ttname"><a href="class_c_y_b_1_1_exception_1_1_internal.html#a710ed917a589d4325fec85c3be07e8c6adc9dc49a6a7bc953e3e1c1e9b095d7bf">CYB::Exception::Internal::MEMORY_COMMITAL_FAILURE</a></div><div class="ttdoc">Memory could not be commited from a reservation. </div><div class="ttdef"><b>Definition:</b> <a href="_exception_8hpp_source.html#l00106">Exception.hpp:106</a></div></div>
<div class="ttc" id="_c_y_b_8hpp_html"><div class="ttname"><a href="_c_y_b_8hpp.html">CYB.hpp</a></div><div class="ttdoc">Precompiled header for inter-engine operations. </div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_aad25779b8de468752210a7dba03ec033"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#aad25779b8de468752210a7dba03ec033">CYB::Platform::System::VirtualMemory::AccessLevel</a></div><div class="ttdeci">AccessLevel</div><div class="ttdoc">Memory permissions. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_virtual_memory_8hpp_source.html#l00011">CYBVirtualMemory.hpp:11</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory_html_ac7ed65763e3bc22cb24270f1506c402b"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_implementation_1_1_virtual_memory.html#ac7ed65763e3bc22cb24270f1506c402b">CYB::Platform::System::Implementation::VirtualMemory::SystemPageSize</a></div><div class="ttdeci">static unsigned int SystemPageSize(void) noexcept</div><div class="ttdoc">Retrieve the system page size. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00003">CYBWin32VirtualMemory.cpp:3</a></div></div>
<div class="ttc" id="namespace_c_y_b_html_ac530f286744fc3b6c07ab8607d6ff192"><div class="ttname"><a href="namespace_c_y_b.html#ac530f286744fc3b6c07ab8607d6ff192">CYB::Core</a></div><div class="ttdeci">Engine::Core &amp; Core(void) noexcept</div><div class="ttdoc">Retrieve the Core singleton. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_core_8cpp_source.html#l00051">CYBCore.cpp:51</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory_html_ab66b2c60b2172d5bf19faeae61f61dbf"><div class="ttname"><a href="class_c_y_b_1_1_platform_1_1_system_1_1_virtual_memory.html#ab66b2c60b2172d5bf19faeae61f61dbf">CYB::Platform::System::VirtualMemory::Access</a></div><div class="ttdeci">void Access(const AccessLevel AAccess)</div><div class="ttdoc">Set the memory protection on a reservation. Does nothing without a previous commit. </div><div class="ttdef"><b>Definition:</b> <a href="_c_y_b_win32_virtual_memory_8cpp_source.html#l00049">CYBWin32VirtualMemory.cpp:49</a></div></div>
<div class="ttc" id="class_c_y_b_1_1_a_p_i_1_1_assert_html_a48f599989cfa6afa4419c2ebf8283090"><div class="ttname"><a href="class_c_y_b_1_1_a_p_i_1_1_assert.html#a48f599989cfa6afa4419c2ebf8283090">CYB::API::Assert::LessThanOrEqual</a></div><div class="ttdeci">static void LessThanOrEqual(const AType &amp;ALHS, const AType &amp;ARHS) noexcept</div><div class="ttdoc">Less than or equal assertion function. May not be evaluated. </div></div>
<div class="ttc" id="class_c_y_b_1_1_exception_1_1_internal_html"><div class="ttname"><a href="class_c_y_b_1_1_exception_1_1_internal.html">CYB::Exception::Internal</a></div><div class="ttdoc">Exceptions that are thrown internally in the engine that the should never see, these are a superset o...</div><div class="ttdef"><b>Definition:</b> <a href="_exception_8hpp_source.html#l00102">Exception.hpp:102</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
